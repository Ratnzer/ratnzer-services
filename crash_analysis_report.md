# تقرير تحليل انهيار تطبيق أندرويد (Ratnzer Services)

## 1. ملخص المشكلة
يعاني التطبيق من **انهيار فوري (Instant Crash)** عند الفتح، حيث تظهر شاشة سوداء (أو شاشة التوقف) ثم يغلق التطبيق مباشرة دون أي رسالة خطأ. هذا السلوك يشير إلى فشل في **Native Layer** قبل تحميل محرك الويب (WebView).

## 2. الأسباب الجذرية المحددة

### أ. فقدان ملف إعدادات Firebase (السبب الرئيسي)
التطبيق يستخدم إضافات `@capacitor-firebase/authentication` و `@capacitor/push-notifications`. 
- **المشكلة**: ملف `google-services.json` مفقود من مجلد `android/app/`.
- **الأثر**: عند تشغيل التطبيق، تحاول هذه الإضافات الاتصال بخدمات جوجل. في نظام أندرويد، يؤدي غياب ملف الإعدادات مع وجود "Plugin" نشط في `build.gradle` إلى `RuntimeException` تسبب إغلاق التطبيق فوراً.

### ب. تعارض إصدارات Capacitor و Gradle
المشروع يستخدم **Capacitor 6**، وهو يتطلب إعدادات محددة في بيئة أندرويد:
- **المشكلة**: ملف `variables.gradle` يحتوي على إصدارات قديمة لبعض المكتبات (مثل `androidx.core:core-splashscreen:1.0.1`).
- **الأثر**: عدم التوافق مع Android 14 (API 34) يسبب فشل في تهيئة الشاشة الرئيسية.

### ج. تهيئة الإشعارات في كود React
في ملف `App.tsx` (السطر 388)، يتم استدعاء `PushNotifications.register()` مباشرة عند تشغيل التطبيق.
- **المشكلة**: لا يوجد تحقق مما إذا كانت خدمات جوجل متاحة أو إذا كان الملف موجوداً.
- **الأثر**: هذا الاستدعاء يرسل أمراً للجانب الأصلي (Native) الذي ينهار بسبب السبب (أ).

## 3. الحلول المقترحة

### الحل الفوري (Native Fix)
1. **إضافة ملف `google-services.json`**: يجب الحصول على الملف من لوحة تحكم Firebase ووضعه في مسار `android/app/`.
2. **تحديث `variables.gradle`**: رفع إصدارات المكتبات لتتوافق تماماً مع Capacitor 6.
3. **تعديل `build.gradle`**: إضافة شرط للتحقق من وجود ملف Firebase قبل تطبيق الـ Plugin (تم التأكد من وجوده جزئياً ولكن يحتاج لتعزيز).

### الحل الوقائي (Code Fix)
1. **تعديل `App.tsx`**: إضافة شرط للتحقق من نجاح تهيئة Firebase قبل طلب التسجيل للإشعارات.
2. **تحسين `index.html`**: إضافة نظام مراقبة للـ Native Bridge للتأكد من استقراره قبل بدء تحميل React.

## 4. الخطوات القادمة
سأقوم الآن بتطبيق التعديلات البرمجية الممكنة في المستودع وتقديم التعليمات النهائية للملفات التي يجب إضافتها يدوياً (مثل ملفات Firebase السرية).
